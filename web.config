<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <!-- Disable directory browsing -->
    <directoryBrowse enabled="false" />

    <!-- Block sensitive file extensions (keep .txt allowed for robots.txt) -->
    <security>
      <requestFiltering>
        <fileExtensions>
          <add fileExtension=".sql" allowed="false" />
          <add fileExtension=".sqlite" allowed="false" />
          <add fileExtension=".sqlite3" allowed="false" />
          <add fileExtension=".bak" allowed="false" />
          <add fileExtension=".old" allowed="false" />
          <add fileExtension=".orig" allowed="false" />
          <add fileExtension=".log" allowed="false" />
          <add fileExtension=".ini" allowed="false" />
          <add fileExtension=".env" allowed="false" />
          <add fileExtension=".conf" allowed="false" />
          <add fileExtension=".yml" allowed="false" />
          <add fileExtension=".yaml" allowed="false" />
          <add fileExtension=".toml" allowed="false" />
          <add fileExtension=".lock" allowed="false" />
          <add fileExtension=".diff" allowed="false" />
          <add fileExtension=".patch" allowed="false" />
        </fileExtensions>
      </requestFiltering>
    </security>

    <!-- URL Rewrite rules (requires URL Rewrite module) -->
    <rewrite>
      <rules>
        <!-- Block access to sql/ directory -->
        <rule name="BlockSQLDir" stopProcessing="true">
          <match url="^sql/.*" ignoreCase="true" />
          <action type="CustomResponse" statusCode="403" statusReason="Forbidden" statusDescription="Access denied." />
        </rule>
        <!-- Block VCS directories if present -->
        <rule name="BlockVcsDirs" stopProcessing="true">
          <match url="^(\.git|\.svn)/.*" ignoreCase="true" />
          <action type="CustomResponse" statusCode="403" statusReason="Forbidden" statusDescription="Access denied." />
        </rule>
        <!-- Block node_modules/vendor if accidentally deployed -->
        <rule name="BlockBuildDirs" stopProcessing="true">
          <match url="^(node_modules|vendor)/.*" ignoreCase="true" />
          <action type="CustomResponse" statusCode="403" statusReason="Forbidden" statusDescription="Access denied." />
        </rule>
      </rules>
    </rewrite>
  </system.webServer>
</configuration>

